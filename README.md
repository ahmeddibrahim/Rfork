TO RUN RFORK FUNCTION," type make rfork"
Introduction:
Remote Fork
Remote fork is the procedure of forking a process in a remote node. Such process is the exact copy of the state of its parent process. To be able to fork the process remotely, we must first create snapshot or checkpoint of the state of the process and its memory. Such screenshot is then sent to the remote node to be restored to the state of the parent process. We use an IPC mechanism, sockets, to send such screenshot to the remote node, which will allow it to restore such process. The remote fork function returns zero if it’s the child process, and greater than zero, pid of the parent, if it’s the parent process, mimicking the local fork.
Implementation:
To be able to invoke the remote fork function, rfork(), there must be an IP address to send to. At first the IP address is checked with the local IP address, through the function getmyip(), to check if all we need is local fork rather than a remote fork. If this is the case, then a local fork function, fork(), is invoked rather than the rfork() function. If the destination machine or node is not the local machine, then rfork() is invoked. The first step in rfork() function is dumping the process, in which a screenshot or a checkpoint is taken of the process. Such checkpoint is later restored in the remote machine. The process of dumping the process and restoring it was achieved through the library CRIU, through its command dump and restore. After dumping the process, the screenshots are saved in a directory and zipped to be sent to the remote machine. The IPC used to transfer the zipped file is sockets in a server client communication. As the machine node receives the zipped file, the process is then unzipped and restored in the machine node to continue execution. Accordingly the child node receives a 0 and returns and parent is still on the same PID.
Limitation:
• The rfork function doesn’t establish a connection between the parent and remote child process. To be able to do so, a shadow child and a shadow parent, must be created to at least establish a simple connection between them.
• As we can’t establish connection between the parent and child processes, we can’t control the child or kill it for example as it’s now forked into a remote machine.
• As the IPC communication used in this function is sockets, it’s prone to fails in transferring the process to the remote node.